# CI/CDのお勉強 イントロ

[教材](https://codezine.jp/article/detail/11083)

## CI/CDとは

ソフトウェアの変更を常にテストして自動で本番環境にリリース可能な状態にしておく手法

## CI/CD導入の背景

1. 自動化テストの重要性の高まり
ソフトウェア普及に伴い品質要求が高まってきた→積極的に手動から自動テストへ

e.g. フロントエンドのコードテスト
- 昔 Webページが少量のHTML, JavaScript テスト書くこと自体まれ
- 今 Reactなどの高度で複雑なフレームワークの登場，ビジネスロジックをフロントエンドに持たせる

テストを書くことは必須化

2. アジャイル開発のプラクティスの浸透と進化

アジャイルとは: 小さな変更を少しずつ加えて行って，プロダクトを少しずつ開発していく手法．

より小さな粒度の変更をいかに早くテスト・リリースしてフィドバックを得るかが，アジャイル開発成功の鍵
そして，この要求に応える需要が増えてきた

また，近年のコンテナ，クラウド技術により，本番環境へのデプロイが簡単に．テストをパスした変更を常にリリースして、バグがあればロールバックを行う作業ができるようになった


## CI/CD導入のメリットまとめ

- バグを素早く発見
- 変更を自動でリリース
- テストの実行忘れ
- 環境依存のテストがなくなる

等でき，よりアジャイルな開発が可能！そして，作業効率の上昇


### Note

自動でテストを作ってくれるわけではない．実行する内容は自分で書く必要がある

## テスト自動化の導入にあたり

- テストケースが少ないから導入しない -> まちがい
  - 建築でいう基礎．後になるほど導入が難しい
- 初期状態から導入 -> せいかい
  - 導入しやすいし，少しずつテストカバレッジを増やそ
  - 少しずつCI/CDパス状態が保たれるのはきもちいい

各プロジェクトのREADMEにCI/CDステータスバッジを追加することで，**品質見える化**が進む

## 自動化できるタスク

### テスト自動化

GitHubなどのバージョン管理システム(VCS)と連携
- GitHubに変更を加える度にテスト実行
- テストをパスしないと変更をマージできない機能
  - リグレッション（退行）を防ぐ

### リリース自動化

運用チーム，開発者のヒューマンエラーをなくす

いくつかのステージ
- 本番環境へリリース可能な状態にしておき，実際は手動
- CI/CDでデプロイまで一気にやっちゃう

どちらをとるかは，組織やプロダクトの性質による

### その他もろもろの作業自動化

- コードのコンパイル
- 静的解析
- 依存関係のアップデート
- テストがない静的サイトのビルド
- 他

ほとんどの作業を自動化可能（ただしハードウェア依存なやつはできない場合あり）

小説出版，脆弱性検知＆セキュリティUpdateなんで使い方もある

## 自動化ツールを超えたメリット

### CD/CI, 継続的デプロイ

CD/CIに厳密な定義はないが，一般的には次のように使われる

- 継続的インテグレーション（CI） = **コードの変更を常に自動的にテストすること**
- 継続的デリバリ（CD） = **テストをpassした変更を，いつでも本番環境へリリースできる状態にしておくこと**

そして最後のフェーズとして，
- 継続的デプロイ（これもCD） = **テストをpassした変更を，自動で本番環境へデプロイし，リリースの自動化を行うこと**

テストがpassしたら，passした変更から順次本番環境へリリースするという流れ！

#### Note

CIによりテストがpassしたとしても，全てのバグが潰せるわけではないことに注意！

### 継続的デプロイのメリット

- 迅速なバグ修正
- リスクマネジメント
- 素早く変更点のフィードバックを得る

#### リスクマネジメント

**発生しそうな問題を修正できる範囲に抑え込むこと** = **発生する問題を想定して、発生した場合は対応できるように計画をすすめる**

- 細かい粒度のA,B
- 大きい粒度のC(=A+B)

がある場合，Cだと，一部にバグがあってもその一部を切り離して変更することはできないし，変更が多くてロールバックが難しいが，A, Bに分けた場合は片方リリースしてもう片方をロールバック可能．

こんなケースに対応できるのが継続的デプロイ．

また，この手法により，同じ開発者がA，Bともにリリースしたら実質Cと同じ価値を生み出したので，**リスクが少なく同一価値のリリースができる**ことを意味する.

柔軟にデプロイ＆撤退戦ができるから，開発しやすくなる．
粒度を小さくしておけば，バグを必要以上に恐れなくてもよくなる

#### 素早く変更点のフィードバックを得る

[リーンスタートアップ](https://www.amazon.co.jp/dp/4822248976?tag=secodezine-22)より，

”いかに効率良く最低限の機能を持った試作品を作り、顧客からフィードバックを得るかがスタートアップビジネス成功の鍵”

ソフトウェア開発でも一緒，

1. 実用最小限の機能（MVP）
2. リリース
3. フィードバック

このサイクルを素早く回すために継続的デプロイが生きる

バグが発生したら死ぬようなレベルのものでなければ，多少不安定でもどんどんリリースして本番環境でテストするくらいの気持ちが重要らしい．入念にテストするよりかは，どんどん素早くフィードバックをいただいた方が良い

*フィーチャーフラグ*

テストしたい機能の，スイッチon/offで，その機能をつけたり消したりを簡単に試せる方法

メリット: ユーザにとって価値があるか否かを本番環境でテストできる．

一度リリースしてしまった方がフィードバックを得られて，それをもとにした方が効率的に開発できる場合が多い

**継続的デプロイによる簡単で高速なロールバックによって，フィーチャーフラグに近いことができるようになる**

さらに深い興味がある場合は[これ](https://codezine.jp/article/detail/11083?p=3)を読む
